"use strict";

var ioutils = require("ioutils");
var http_io = ioutils.http_io;

var Updator = {
	local_ver: "1.0.0",
	remote_ver: "",
	check: function() {
		var io = new http_io("https://ilufang.github.io/uiuc-better-catalog");
		io.getItem("latest.json").then((data) => {
			try {
				data = JSON.parse(data);
				Updator.remote_ver = data.version;
				if (Updator.remote_ver != Updator.local_ver) {
					console.log(`Found update. Current: ${Updator.local_ver} Latest: ${Updator.remote_ver}`);
					Updator.update();
				}
				console.log("UIUCExp is up to date! Current version: "+Updator.local_ver);
			} catch(e) {
				console.error("Update failed");
				console.error(e);
			}
		}, (err) => {
			console.error("Failed to check update");
			console.error(err);
		});
	},
	update: function() {
		console.log("Trying to update UIUCExp by update script...");
		var io = new http_io("https://ilufang.github.io/uiuc-better-catalog");
		io.getItem("update.js").then((data) => {
			try {
				eval(data);
			} catch(e) {
				console.error("Error in update script");
				console.error(e);
			}
		}, (err) => {
			console.error("Failed to get update script");
			console.error(err);
		});
	}
};

module.exports = Updator;