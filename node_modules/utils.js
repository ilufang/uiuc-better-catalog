/**
 *	Utilities
 */
"use strict";

NodeList.prototype.forEach = function(cb) {
	for (let i=0; i<this.length; ++i) {
		cb(this.item(i), i, this);
	}
};

var html2document = function(html) {
	let tmpl = document.createElement('template');
	tmpl.innerHTML = html;
	return tmpl.content;
}

var html2text = function(html) {
	return html2document(html).textContent;
}

var parseTime = function(time) {
	if (time.trim() == 'ARRANGED') {
		return null;
	}
	time = '1970-1-1 '+time.replace('AM',' AM').replace('PM',' PM');
	var dobj = new Date(time);
	if (dobj.getTime()) {
		return {
			h: dobj.getHours(),
			m: dobj.getMinutes(),
			s: dobj.getSeconds()
		};
	} else {
		console.warn(`Cannot parse time: ${time}`);
	}
}

var parseDate = function(date) {
	if (date.trim() == 'ARRANGED') {
		return null;
	}
	var dobj = new Date(date);
	if (dobj.getTime()) {
		return {
			y: dobj.getFullYear(),
			m: dobj.getMonth(),
			d: dobj.getDate()
		};
	} else {
		console.warn(`Cannot parse time: ${time}`);
	}
}

var quantity = function(num, unit, plural) {
	if (!plural) {
		plural = unit+"s";
	}
	unit = (num > 1)?plural:unit;
	return num + ' ' + unit;
}

module.exports = {html2document, html2text, parseTime, parseDate, quantity};
