<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<title>RegBot Helper</title>
	<style>
	html, body {
		height: 100%;
	}
	#main {
		height: calc(100% - 1.2em);
	}
	body {
		margin: 0px;
		padding: 0px;
		background: #ccc;
	}
	webview {
		width: 100%;
		height: 100%;
		margin: 0px;
	}
	</style>
</head>
<body>
	<div>
		<button type="button" id="btn-hide">Hide Window</button>
		<span>(You can re-open in RegBot settings)</span>
		<button type="button" id="btn-reload">Reload</button>
		<button type="button" id="btn-home">Registration Home</button>
		<button type="button" id="btn-login">EAS Login</button>
	</div>
	<div id="main">
		<webview id="regbot-wv"></webview>
	</div>
	<script type="text/javascript">
	// Bootstrap
	const {ipcRenderer} = require("electron");
	const RBWV = require("regd-wvmgr");
	function init(prefs) {
		let host = {
			msg: function(type, msg) {
				ipcRenderer.send("regbot.log", `[${type}] ${msg}`);
			},
			pref: prefs
		};
		window.webview = document.querySelector("#regbot-wv");
		window.regbot = new RBWV(host, webview);
		host.msg("success", "RegBot service started.");
	}
	ipcRenderer.send("regbot.ready");

	// IPC actions
	function getSeats(dept, num) {
		regbot.getCourseSeats(dept, num).then(result => {
			ipcRenderer.send("regbot.seatinfo", result);
		});
	}

	// UI actions
	document.querySelector("#btn-hide").addEventListener("click", function() {
		ipcRenderer.send("regbot.hide");
	});

	document.querySelector("#btn-reload").addEventListener("click", function() {
		webview.reload();
	});

	document.querySelector("#btn-home").addEventListener("click", function() {
		regbot.regHome();
	});

	document.querySelector("#btn-login").addEventListener("click", function() {
		regbot.easlogin();
	});

	// No close
	window.onbeforeunload = (e) => {
		e.returnValue = false;
	}
	</script>
</body>
</html>
